<div class="communication-container">
  <div class="header-section">
    <div class="header-content">
      <h1 class="page-title">
        <i class="fas fa-comments"></i>
        Communication Center
      </h1>
      <p class="page-subtitle">Send email and SMS notifications to patients</p>
    </div>
  </div>

  <div class="communication-grid">
    <div class="communication-card email-card">
      <div class="card-header">
        <div class="card-icon email-icon">
          <i class="fas fa-envelope"></i>
        </div>
        <h3 class="card-title">Email Notification</h3>
      </div>
      <div class="card-body">
        
        <div class="form-group">
          <label class="form-label">Email Template</label>
          <select class="form-control" [(ngModel)]="selectedEmailTemplate" (ngModelChange)="onEmailTemplateChange()">
            <option *ngFor="let t of emailTemplates" [ngValue]="t">{{t.name}}</option>
          </select>
        </div>

        <div class="form-group" *ngIf="getTemplateContent(selectedEmailTemplate)">
          <label class="form-label">Template Preview</label>
          <div class="template-preview">
            <pre class="preview-content">{{ getEmailPreview() }}</pre>
          </div>

          <div class="checkbox-wrapper">
            <input type="checkbox" id="showPayloadEmail" [(ngModel)]="showPayloadEmail">
            <label for="showPayloadEmail">Show payload</label>
          </div>

          <div class="payload-section" *ngIf="showPayloadEmail">
            <pre class="payload-box">{{ buildEmailPayload() | json }}</pre>
          </div>
        </div>
        

        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Recipient Email *</label>
            <input type="email" class="form-control" [(ngModel)]="modelEmail.recipientEmail" required>
          </div>
          <div class="form-group">
            <label class="form-label">Recipient Name *</label>
            <input type="text" class="form-control" [(ngModel)]="modelEmail.recipientName" required>
          </div>
        </div>

        <div class="form-group" *ngIf="selectedEmailTemplate">
          <label class="form-label">Template Variables</label>
          <app-template-variables #emailVariables 
                                [variables]="emailTemplateVariables"
                                type="email"
                                (variablesChanged)="onVariableChange('email')"></app-template-variables>
        </div>
      </div>
      <div class="card-footer">
        <button class="send-btn email-btn" (click)="sendEmail()">
          <i class="fas fa-paper-plane"></i>
          Send Email
        </button>
      </div>
    </div>

    <div class="communication-card sms-card">
      <div class="card-header">
        <div class="card-icon sms-icon">
          <i class="fas fa-sms"></i>
        </div>
        <h3 class="card-title">SMS Notification</h3>
      </div>
      <div class="card-body">
        
        <div class="form-group">
          <label class="form-label">SMS Template</label>
          <select class="form-control" [(ngModel)]="selectedSmsTemplate" (ngModelChange)="onSmsTemplateChange()">
            <option *ngFor="let t of smsTemplates" [ngValue]="t">{{t.name}}</option>
          </select>
        </div>

        <div class="form-group" *ngIf="getTemplateContent(selectedSmsTemplate)">
          <label class="form-label">Template Preview</label>
          <div class="template-preview">
            <pre class="preview-content">{{ getSmsPreview() }}</pre>
          </div>

          <div class="checkbox-wrapper">
            <input type="checkbox" id="showPayloadSms" [(ngModel)]="showPayloadSms">
            <label for="showPayloadSms">Show payload</label>
          </div>

          <div class="payload-section" *ngIf="showPayloadSms">
            <pre class="payload-box">{{ buildSmsPayload() | json }}</pre>
          </div>
        </div>
        

        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Recipient Phone *</label>
            <input type="tel" class="form-control" [(ngModel)]="modelSms.recipientPhone" required>
          </div>
          <div class="form-group">
            <label class="form-label">Recipient Name *</label>
            <input type="text" class="form-control" [(ngModel)]="modelSms.recipientName" required>
          </div>
        </div>

        <div class="form-group" *ngIf="selectedSmsTemplate">
          <label class="form-label">Template Variables</label>
          <app-template-variables #smsVariables 
                                [variables]="smsTemplateVariables"
                                type="sms"
                                (variablesChanged)="onVariableChange('sms')"></app-template-variables>
        </div>
      </div>
      <div class="card-footer">
        <button class="send-btn sms-btn" (click)="sendSms()">
          <i class="fas fa-mobile-alt"></i>
          Send SMS
        </button>
      </div>
    </div>
  </div>
</div>